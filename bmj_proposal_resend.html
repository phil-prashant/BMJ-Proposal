<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BMJ-Machinery Custom Marketing Proposal</title>
    <script src="https://cdn.jsdelivr.net/npm/pdfkit@0.13.0/js/pdfkit.standalone.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            color: #1a202c;
            line-height: 1.6;
        }

        /* ===== STICKY HEADER ===== */
        .sticky-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: #1a202c;
            border-bottom: 3px solid #0891b2;
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .header-left {
            flex: 1;
            min-width: 200px;
        }

        .header-metrics {
            font-size: 13px;
            color: #e2e8f0;
            font-weight: 500;
        }

        .header-total {
            font-size: 14px;
            color: #06b6d4;
            font-weight: 700;
        }

        .header-buttons {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn-header {
            padding: 10px 18px;
            font-size: 13px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .btn-clear {
            background: transparent;
            border: 2px solid #fff;
            color: #fff;
            opacity: 0.6;
            display: none;
        }

        .btn-clear.visible {
            display: inline-block;
            opacity: 1;
        }

        .btn-clear:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .btn-email {
            background: #ea580c;
            color: white;
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .btn-email.enabled {
            opacity: 1;
            cursor: pointer;
            pointer-events: all;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .btn-email.enabled:hover {
            background: #d84700;
            transform: translateY(-2px);
        }

        /* ===== MOBILE STICKY FOOTER ===== */
        @media (max-width: 767px) {
            .sticky-header {
                position: fixed;
                bottom: 0;
                top: auto;
                flex-direction: column;
                padding: 12px;
            }

            .header-buttons {
                width: 100%;
            }

            .btn-header {
                flex: 1;
                padding: 12px 10px;
                font-size: 12px;
            }
        }

        /* ===== MAIN CONTENT ===== */
        .container {
            max-width: 1200px;
            margin: 80px auto 120px;
            padding: 0 20px;
        }

        @media (max-width: 767px) {
            .container {
                margin: 20px auto 140px;
            }
        }

        /* ===== INTRO SECTION ===== */
        .intro-section {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 40px;
        }

        .intro-title {
            font-size: 28px;
            color: #1a202c;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .intro-greeting {
            font-size: 16px;
            color: #2d3748;
            margin-bottom: 16px;
            font-weight: 600;
        }

        .intro-text {
            font-size: 15px;
            color: #4a5568;
            line-height: 1.8;
            margin-bottom: 20px;
        }

        .intro-instructions {
            background: #f0f9ff;
            border-left: 4px solid #0891b2;
            padding: 16px;
            border-radius: 6px;
            margin-top: 16px;
        }

        .intro-instructions h4 {
            color: #0891b2;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .intro-instructions ol {
            margin-left: 20px;
            font-size: 14px;
            color: #2d3748;
        }

        .intro-instructions li {
            margin-bottom: 8px;
        }

        /* ===== PACKAGES SECTION ===== */
        .section-title {
            font-size: 24px;
            color: #1a202c;
            margin-bottom: 30px;
            font-weight: 700;
            padding-bottom: 12px;
            border-bottom: 2px solid #0891b2;
        }

        .packages-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 24px;
            margin-bottom: 50px;
        }

        @media (min-width: 1200px) {
            .packages-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .package-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .package-card:hover {
            border-color: #0891b2;
            box-shadow: 0 8px 24px rgba(6, 182, 212, 0.15);
            transform: translateY(-4px);
        }

        .package-card.selected {
            border-color: #0891b2;
            background: #f0f9ff;
            box-shadow: 0 8px 24px rgba(6, 182, 212, 0.2);
        }

        .package-radio-wrapper {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 16px;
        }

        .package-radio {
            width: 24px;
            height: 24px;
            min-width: 24px;
            cursor: pointer;
            accent-color: #0891b2;
        }

        .package-name {
            font-size: 18px;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 4px;
        }

        .package-price {
            font-size: 16px;
            color: #0891b2;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .package-desc {
            font-size: 14px;
            color: #4a5568;
            margin-bottom: 16px;
            line-height: 1.6;
        }

        .package-metrics {
            background: #f7fafc;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 16px;
            font-size: 13px;
            color: #2d3748;
        }

        .package-deliverables {
            font-size: 13px;
            color: #4a5568;
        }

        .package-deliverables li {
            margin-bottom: 6px;
            margin-left: 16px;
        }

        /* ===== ADDONS SECTION ===== */
        .addons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 50px;
        }

        @media (min-width: 1024px) {
            .addons-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .addon-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0.5;
            pointer-events: none;
        }

        .addon-card.enabled {
            opacity: 1;
            pointer-events: all;
        }

        .addon-card.enabled:hover {
            border-color: #0891b2;
            box-shadow: 0 8px 24px rgba(6, 182, 212, 0.15);
            transform: translateY(-4px);
        }

        .addon-card.selected {
            background: #f0f9ff;
            border-color: #0891b2;
        }

        .addon-checkbox-wrapper {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 12px;
        }

        .addon-checkbox {
            width: 24px;
            height: 24px;
            min-width: 24px;
            cursor: pointer;
            accent-color: #0891b2;
        }

        .addon-name {
            font-size: 16px;
            font-weight: 700;
            color: #1a202c;
        }

        .addon-price {
            font-size: 14px;
            color: #0891b2;
            font-weight: 600;
        }

        .addon-desc {
            font-size: 13px;
            color: #4a5568;
            margin-top: 8px;
        }

        /* ===== PAYMENT TERM SECTION ===== */
        .payment-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 50px;
        }

        .payment-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .payment-option {
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .payment-option:hover {
            border-color: #0891b2;
        }

        .payment-option.selected {
            background: #f0f9ff;
            border-color: #0891b2;
        }

        .payment-radio {
            width: 20px;
            height: 20px;
            accent-color: #0891b2;
            margin-bottom: 12px;
        }

        .payment-label {
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 8px;
            display: block;
        }

        .payment-savings {
            background: #fef08a;
            color: #854d0e;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 12px;
        }

        /* ===== TERMS SECTION ===== */
        .terms-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 50px;
            scroll-margin-top: 100px;
        }

        .terms-checkbox-wrapper {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 20px;
            background: #f0f9ff;
            border: 2px solid #0891b2;
            border-radius: 10px;
            margin-bottom: 20px;
            animation: highlightPulse 3s ease-in-out;
        }

        @keyframes highlightPulse {
            0%, 100% { transform: scale(1); background: #f0f9ff; }
            50% { transform: scale(1.02); background: #e0f7ff; }
        }

        .terms-checkbox {
            width: 24px;
            height: 24px;
            min-width: 24px;
            cursor: pointer;
            accent-color: #0891b2;
            margin-top: 2px;
        }

        .terms-label {
            font-size: 15px;
            font-weight: 600;
            color: #1a202c;
            cursor: pointer;
        }

        .terms-content {
            font-size: 14px;
            color: #4a5568;
            line-height: 1.8;
        }

        .terms-content h4 {
            color: #1a202c;
            margin: 20px 0 10px;
            font-size: 15px;
            font-weight: 700;
        }

        .terms-content ul {
            margin-left: 20px;
            margin-bottom: 12px;
        }

        .terms-content li {
            margin-bottom: 8px;
        }

        /* ===== MODAL ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-height: 80vh;
            width: 100%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 2px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 18px;
            color: #1a202c;
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #4a5568;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            color: #1a202c;
        }

        .modal-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 2px solid #e2e8f0;
            display: flex;
            gap: 12px;
        }

        .email-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
        }

        .email-input:focus {
            outline: none;
            border-color: #0891b2;
            box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
        }

        .proposal-summary {
            font-size: 13px;
            color: #4a5568;
            background: #f7fafc;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 16px;
            line-height: 1.6;
        }

        .proposal-summary strong {
            color: #1a202c;
        }

        .btn-send {
            flex: 1;
            padding: 12px 20px;
            background: #0891b2;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-send:hover:not(:disabled) {
            background: #0284a5;
        }

        .btn-send:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-cancel {
            flex: 1;
            padding: 12px 20px;
            background: #e2e8f0;
            color: #1a202c;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-cancel:hover {
            background: #cbd5e0;
        }

        /* ===== TOAST ===== */
        .toast {
            position: fixed;
            bottom: 140px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 16px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            animation: slideIn 0.3s ease;
            z-index: 3000;
        }

        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* ===== FLOATING FINALIZE BUTTON ===== */
        .finalize-btn-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 500;
        }

        @media (max-width: 767px) {
            .finalize-btn-container {
                display: none;
            }
        }

        .btn-finalize {
            padding: 16px 32px;
            background: #ea580c;
            color: white;
            border: none;
            border-radius: 50px;
            font-weight: 700;
            font-size: 15px;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(234, 88, 12, 0.3);
            transition: all 0.3s ease;
            opacity: 0.5;
            pointer-events: none;
        }

        .btn-finalize.enabled {
            opacity: 1;
            pointer-events: all;
            animation: pulse 2s infinite;
        }

        .btn-finalize.enabled:hover {
            background: #d84700;
            transform: translateY(-4px);
            box-shadow: 0 12px 28px rgba(234, 88, 12, 0.4);
        }
    </style>
</head>
<body>
    <!-- STICKY HEADER -->
    <div class="sticky-header">
        <div class="header-left">
            <div class="header-total">Total: <span id="header-total">Select package</span></div>
            <div class="header-metrics">Payment: <span id="header-payment">â€”</span> | <span id="header-prospects">â€”</span></div>
        </div>
        <div class="header-buttons">
            <button class="btn-header btn-clear" id="clear-btn">ðŸ”„ Clear Selections</button>
            <button class="btn-header btn-email" id="email-btn-header">ðŸ“§ Email Proposal</button>
        </div>
    </div>

    <!-- MAIN CONTAINER -->
    <div class="container">
        <!-- INTRO SECTION -->
        <div class="intro-section">
            <div class="intro-greeting">Dear Eric / Chi Feng,</div>
            <div class="intro-title">Your Custom Marketing Proposal</div>
            <div class="intro-text">
                Welcome! This interactive proposal allows you to build a custom marketing solution tailored to BMJ-Machinery's needs. Select the services that align with your goals, and we'll provide you with transparent pricing and expected outcomes.
            </div>
            <div class="intro-instructions">
                <h4>ðŸ“‹ How to Use This Page:</h4>
                <ol>
                    <li><strong>Step 1 - Select Base Package:</strong> Choose one of our 3 comprehensive packages (Growth Accelerator, Market Domination, or Enterprise Authority) by clicking the radio button.</li>
                    <li><strong>Step 2 - Add Strategic Add-ons:</strong> Customize your solution by selecting optional add-ons like Press Release Distribution, Video Production, and more.</li>
                    <li><strong>Step 3 - Choose Payment Frequency:</strong> Select Monthly, Quarterly, Bi-Annual, or Annual billing. Longer commitments come with attractive discounts (5%, 10%, or 15%).</li>
                    <li><strong>Step 4 - Finalize & Review:</strong> Click "Finalize Selections" to review your choices and agree to the Terms & Conditions.</li>
                    <li><strong>Step 5 - Email Your Proposal:</strong> Once finalized and agreed to, click "Email Proposal" to receive your customized PDF proposal via email.</li>
                </ol>
            </div>
        </div>

        <!-- PACKAGES SECTION -->
        <h2 class="section-title">Choose Your Base Package</h2>
        <div class="packages-grid" id="packages-container"></div>

        <!-- ADDONS SECTION -->
        <h2 class="section-title">Customize with Add-ons</h2>
        <div class="addons-grid" id="addons-container"></div>

        <!-- PAYMENT TERM SECTION -->
        <div class="payment-section">
            <h2 class="section-title" style="margin-top: 0;">Payment Frequency</h2>
            <div class="payment-options" id="payment-terms-container"></div>
        </div>

        <!-- TERMS SECTION -->
        <div class="terms-section" id="terms-section">
            <h2 class="section-title">Agreement & Terms</h2>

            <div class="terms-checkbox-wrapper">
                <input type="checkbox" id="terms-checkbox" class="terms-checkbox">
                <label for="terms-checkbox" class="terms-label">â˜‘ I have reviewed and agree to the Terms & Conditions, Assumptions, and Client Commitments outlined below</label>
            </div>

            <div class="terms-content">
                <h4>Assumptions</h4>
                <ul>
                    <li>Target audience responsiveness at industry benchmark levels</li>
                    <li>Access to company resources and marketing assets</li>
                    <li>Timely approvals on content (48-72 hours)</li>
                    <li>Monthly strategy call availability</li>
                    <li>Stable market conditions</li>
                </ul>

                <h4>Client Commitments</h4>
                <ul>
                    <li>Designate a primary contact for communication</li>
                    <li>Provide platform access (LinkedIn, email, analytics)</li>
                    <li>Review and approve content on schedule</li>
                    <li>Participate in monthly strategy sessions</li>
                    <li>Share technical information as needed</li>
                    <li>Respond to qualified prospects within 24-48 hours</li>
                </ul>

                <h4>Terms & Conditions</h4>
                <ul>
                    <li><strong>Minimum Contract Period:</strong> 3 months</li>
                    <li><strong>Notice Period:</strong> 30 days from either party for termination</li>
                    <li><strong>Payment Terms:</strong> Net 15 days</li>
                    <li><strong>Setup Fees:</strong> Due upon contract signing</li>
                    <li><strong>Monthly Fees:</strong> Billed in advance</li>
                    <li><strong>Metrics Disclaimer:</strong> All projected outcomes (prospects reached, leads, meetings) are estimates based on historical performance and market conditions. Results are not guaranteed and may vary based on implementation, market response, and external factors.</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- FINALIZE BUTTON (Desktop) -->
    <div class="finalize-btn-container">
        <button class="btn-finalize" id="finalize-btn">Finalize Selections â†’</button>
    </div>

    <!-- EMAIL MODAL -->
    <div class="modal" id="email-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Email Your Proposal</h3>
                <button class="modal-close" id="modal-close">Ã—</button>
            </div>
            <div class="modal-body">
                <label for="recipient-email" style="display: block; font-weight: 600; margin-bottom: 8px; color: #1a202c;">Send Proposal To:</label>
                <input type="email" id="recipient-email" class="email-input" placeholder="Enter recipient email" value="prashant@neoticai.com">

                <div class="proposal-summary" id="proposal-summary"></div>

                <button class="btn-send" id="send-email-btn">Send Email with PDF â†’</button>
            </div>
        </div>
    </div>

    <!-- TOAST NOTIFICATION -->
    <div id="toast"></div>

    <script>
        // ===== CONFIGURATION =====
        const RESEND_API_KEY = 're_73miNRj6_83vuf1KSmVNeiAwBM1U37jtN';
        const EMAILJS_SERVICE_ID = 'service_kkb35zr';
        const EMAILJS_TEMPLATE_ID = 'template_dbqjamx';
        const EMAILJS_PUBLIC_KEY = 'lWcX2ZAuSeQUVvyNk';
        const SENDER_EMAIL = 'prashant@neoticai.com';
        const SENDER_NAME = 'NeoticAI Team';

        // ===== STATE MANAGEMENT =====
        let state = {
            selectedPackage: null,
            selectedAddons: [],
            selectedPaymentTerm: 'monthly',
            hasAgreed: false,
            isFinalized: false,
            selections: {}
        };

        // ===== PACKAGE DATA =====
        const packages = [
            {
                id: 'growth',
                name: 'Growth Accelerator',
                monthlyPrice: 5500,
                setupPrice: 2000,
                prospects: '1,000-1,500',
                description: 'Integrated lead generation foundation with AI chatbot qualification and content creation',
                deliverables: [
                    'LinkedIn & Email outreach campaigns',
                    'AI chatbot for lead qualification',
                    'Monthly content creation & SEO foundation',
                    'Monthly strategy call'
                ]
            },
            {
                id: 'market',
                name: 'Market Domination',
                monthlyPrice: 8900,
                setupPrice: 3500,
                prospects: '2,500-3,500',
                description: 'Advanced automation with video production, YouTube channel management, and comprehensive SEO',
                deliverables: [
                    'LinkedIn & Email with advanced automation',
                    'AI chatbot with lead scoring',
                    '2 professional videos per month',
                    'YouTube channel optimization',
                    'Comprehensive SEO strategy',
                    'Bi-weekly strategy calls'
                ]
            },
            {
                id: 'enterprise',
                name: 'Enterprise Authority',
                monthlyPrice: 12500,
                setupPrice: 5000,
                prospects: '4,000-5,500',
                description: 'Complete go-to-market with website redesign, thought leadership, and PR distribution',
                deliverables: [
                    'Everything in Market Domination PLUS:',
                    'Complete website redesign (10-12 pages)',
                    'Thought leadership program (4 articles/month)',
                    'Monthly video production & YouTube management',
                    'PR distribution to 100+ outlets',
                    'Dedicated account manager',
                    'Weekly strategy calls'
                ]
            }
        ];

        // ===== ADDON DATA =====
        const addons = [
            {
                id: 'press',
                name: 'Press Release Distribution',
                price: 2800,
                description: '100+ media outlets across any 2 countries and any 5 industries of your choice, 170M+ active reader reach',
                impact: '+5-10 additional prospects'
            },
            {
                id: 'video',
                name: 'Extra Video Production',
                price: 1800,
                description: 'Additional professional video beyond monthly allocation',
                impact: '+200-300 prospects reach'
            },
            {
                id: 'analytics',
                name: 'Advanced Analytics Dashboard',
                price: 800,
                description: 'Real-time analytics, custom reports, and performance tracking',
                impact: 'Full visibility into results'
            },
            {
                id: 'copywriter',
                name: 'Dedicated Copywriter',
                price: 1500,
                description: 'Full-time copywriter for all messaging and content creation',
                impact: '+20% engagement increase'
            },
            {
                id: 'pages',
                name: 'Additional Website Pages',
                price: 500,
                description: 'Per additional custom web page (case studies, landing pages, etc.)',
                impact: '+50-100 prospects per page'
            },
            {
                id: 'social',
                name: 'Social Media Management',
                price: 1200,
                description: 'LinkedIn, Twitter, and industry-specific platforms',
                impact: '+15% brand visibility'
            },
            {
                id: 'cro',
                name: 'Conversion Rate Optimization',
                price: 2000,
                description: 'A/B testing, landing page optimization, and funnel analysis',
                impact: '+25-40% conversion improvement'
            }
        ];

        // ===== PAYMENT TERMS =====
        const paymentTerms = [
            { id: 'monthly', label: 'Monthly', discount: 0, savings: 0 },
            { id: 'quarterly', label: 'Quarterly', discount: 5, savings: '5% savings' },
            { id: 'biannual', label: 'Bi-Annual', discount: 10, savings: '10% savings' },
            { id: 'annual', label: 'Annual', discount: 15, savings: 'â­ Best Value - 15% savings' }
        ];

        // ===== INITIALIZATION =====
        function init() {
            renderPackages();
            renderAddons();
            renderPaymentTerms();
            attachEventListeners();
        }

        // ===== RENDER PACKAGES =====
        function renderPackages() {
            const container = document.getElementById('packages-container');
            container.innerHTML = packages.map(pkg => `
                <div class="package-card" data-package-id="${pkg.id}">
                    <div class="package-radio-wrapper">
                        <input type="radio" name="basePackage" class="package-radio" value="${pkg.id}" id="pkg-${pkg.id}">
                        <div style="flex: 1;">
                            <label for="pkg-${pkg.id}" class="package-name">${pkg.name}</label>
                            <div class="package-price">$${pkg.monthlyPrice.toLocaleString()}/month</div>
                        </div>
                    </div>
                    <div class="package-desc">${pkg.description}</div>
                    <div class="package-metrics">
                        <strong>Prospects Reached Monthly:</strong> ${pkg.prospects}
                    </div>
                    <div class="package-deliverables">
                        <strong>Includes:</strong>
                        <ul>
                            ${pkg.deliverables.map(d => `<li>${d}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `).join('');

            document.querySelectorAll('.package-radio').forEach(radio => {
                radio.addEventListener('change', handlePackageChange);
            });
        }

        // ===== RENDER ADDONS =====
        function renderAddons() {
            const container = document.getElementById('addons-container');
            container.innerHTML = addons.map(addon => `
                <div class="addon-card" data-addon-id="${addon.id}">
                    <div class="addon-checkbox-wrapper">
                        <input type="checkbox" class="addon-checkbox addon-checkbox-input" data-addon-id="${addon.id}" id="addon-${addon.id}">
                        <div style="flex: 1;">
                            <label for="addon-${addon.id}" class="addon-name">${addon.name}</label>
                            <div class="addon-price">+$${addon.price.toLocaleString()}</div>
                        </div>
                    </div>
                    <div class="addon-desc"><strong>${addon.description}</strong></div>
                    <div class="addon-desc">${addon.impact}</div>
                </div>
            `).join('');

            document.querySelectorAll('.addon-checkbox-input').forEach(checkbox => {
                checkbox.addEventListener('change', handleAddonChange);
            });

            updateAddonStates();
        }

        // ===== RENDER PAYMENT TERMS =====
        function renderPaymentTerms() {
            const container = document.getElementById('payment-terms-container');
            container.innerHTML = paymentTerms.map(term => `
                <label class="payment-option">
                    <input type="radio" name="paymentTerm" class="payment-radio" value="${term.id}" ${term.id === 'monthly' ? 'checked' : ''}>
                    <span class="payment-label">${term.label}</span>
                    ${term.savings ? `<div class="payment-savings">${term.savings}</div>` : ''}
                </label>
            `).join('');

            document.querySelectorAll('input[name="paymentTerm"]').forEach(radio => {
                radio.addEventListener('change', handlePaymentTermChange);
            });
        }

        // ===== EVENT HANDLERS =====
        function handlePackageChange(e) {
            if (e.target.checked) {
                state.selectedPackage = e.target.value;
                document.querySelectorAll('.package-card').forEach(card => {
                    card.classList.toggle('selected', card.dataset.packageId === state.selectedPackage);
                });
                updateAddonStates();
                updateHeaderAndButtons();
                showClearButton();
            }
        }

        function handleAddonChange(e) {
            const addonId = e.target.dataset.addonId;
            if (e.target.checked) {
                state.selectedAddons.push(addonId);
            } else {
                state.selectedAddons = state.selectedAddons.filter(id => id !== addonId);
            }
            document.querySelectorAll('.addon-card').forEach(card => {
                const checkbox = card.querySelector('.addon-checkbox-input');
                card.classList.toggle('selected', checkbox.checked);
            });
            updateHeaderAndButtons();
        }

        function handlePaymentTermChange(e) {
            state.selectedPaymentTerm = e.target.value;
            document.querySelectorAll('.payment-option').forEach(option => {
                option.classList.toggle('selected', option.querySelector('input').value === state.selectedPaymentTerm);
            });
            updateHeaderAndButtons();
        }

        // ===== UPDATE FUNCTIONS =====
        function updateAddonStates() {
            const hasPackage = !!state.selectedPackage;
            document.querySelectorAll('.addon-card').forEach(card => {
                if (hasPackage) {
                    card.classList.add('enabled');
                } else {
                    card.classList.remove('enabled');
                    card.querySelector('.addon-checkbox-input').checked = false;
                }
            });
            state.selectedAddons = [];
        }

        function updateHeaderAndButtons() {
            const pkg = packages.find(p => p.id === state.selectedPackage);
            if (!pkg) {
                document.getElementById('header-total').textContent = 'Select package';
                document.getElementById('header-payment').textContent = 'â€”';
                document.getElementById('header-prospects').textContent = 'â€”';
                document.getElementById('finalize-btn').classList.remove('enabled');
                document.getElementById('email-btn-header').classList.remove('enabled');
                return;
            }

            const term = paymentTerms.find(t => t.id === state.selectedPaymentTerm);
            const monthlyTotal = calculateTotal(false);
            const afterDiscount = monthlyTotal * (1 - term.discount / 100);

            document.getElementById('header-total').textContent = `$${Math.round(afterDiscount).toLocaleString()}/mo + $${Math.round(pkg.setupPrice * (1 - term.discount / 100)).toLocaleString()} setup`;
            document.getElementById('header-payment').textContent = term.label;
            document.getElementById('header-prospects').textContent = pkg.prospects;

            document.getElementById('finalize-btn').classList.add('enabled');

            if (state.hasAgreed) {
                document.getElementById('email-btn-header').classList.add('enabled');
            }
        }

        function calculateTotal(includeSetup = true) {
            const pkg = packages.find(p => p.id === state.selectedPackage);
            if (!pkg) return 0;

            let total = pkg.monthlyPrice;
            state.selectedAddons.forEach(addonId => {
                const addon = addons.find(a => a.id === addonId);
                if (addon) total += addon.price;
            });

            if (includeSetup) total += pkg.setupPrice;
            return total;
        }

        function showClearButton() {
            document.getElementById('clear-btn').classList.add('visible');
        }

        // ===== FINALIZE =====
        function attachEventListeners() {
            document.getElementById('finalize-btn').addEventListener('click', handleFinalize);
            document.getElementById('clear-btn').addEventListener('click', handleClear);
            document.getElementById('email-btn-header').addEventListener('click', handleEmailClick);
            document.getElementById('modal-close').addEventListener('click', closeModal);
            document.getElementById('send-email-btn').addEventListener('click', sendEmail);
            document.getElementById('terms-checkbox').addEventListener('change', handleTermsChange);
        }

        function handleFinalize() {
            if (!state.selectedPackage) return;
            state.isFinalized = true;

            const termsSection = document.getElementById('terms-section');
            termsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });

            setTimeout(() => {
                const checkbox = document.getElementById('terms-checkbox');
                checkbox.closest('.terms-checkbox-wrapper').style.animation = 'none';
                void checkbox.closest('.terms-checkbox-wrapper').offsetWidth;
                checkbox.closest('.terms-checkbox-wrapper').style.animation = 'highlightPulse 3s ease-in-out';
                showToast('Please review and agree to terms below');
            }, 600);
        }

        function handleTermsChange(e) {
            state.hasAgreed = e.target.checked;
            if (state.hasAgreed) {
                document.getElementById('email-btn-header').classList.add('enabled');
                showToast('âœ“ You can now email your proposal!');
            } else {
                document.getElementById('email-btn-header').classList.remove('enabled');
            }
        }

        function handleClear() {
            if (confirm('Are you sure you want to clear all selections?')) {
                state = {
                    selectedPackage: null,
                    selectedAddons: [],
                    selectedPaymentTerm: 'monthly',
                    hasAgreed: false,
                    isFinalized: false,
                    selections: {}
                };

                document.querySelectorAll('input[name="basePackage"]').forEach(r => r.checked = false);
                document.querySelectorAll('.addon-checkbox-input').forEach(c => c.checked = false);
                document.querySelector('input[value="monthly"]').checked = true;
                document.getElementById('terms-checkbox').checked = false;
                document.querySelectorAll('.package-card, .addon-card').forEach(c => c.classList.remove('selected'));
                document.getElementById('clear-btn').classList.remove('visible');
                document.getElementById('finalize-btn').classList.remove('enabled');
                document.getElementById('email-btn-header').classList.remove('enabled');
                updateHeaderAndButtons();
                window.scrollTo({ top: 0, behavior: 'smooth' });
                showToast('âœ“ All selections cleared');
            }
        }

        function handleEmailClick() {
            if (!state.isFinalized || !state.hasAgreed || !state.selectedPackage) return;
            updateProposalSummary();
            document.getElementById('email-modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('email-modal').classList.remove('active');
        }

        function updateProposalSummary() {
            const pkg = packages.find(p => p.id === state.selectedPackage);
            const term = paymentTerms.find(t => t.id === state.selectedPaymentTerm);
            const monthlyTotal = calculateTotal(false);
            const discountedMonthly = monthlyTotal * (1 - term.discount / 100);
            const setupDiscounted = pkg.setupPrice * (1 - term.discount / 100);

            let summary = `<strong>Package:</strong> ${pkg.name}<br>`;
            summary += `<strong>Monthly:</strong> $${Math.round(discountedMonthly).toLocaleString()}<br>`;
            summary += `<strong>Setup:</strong> $${Math.round(setupDiscounted).toLocaleString()}<br>`;
            if (state.selectedAddons.length > 0) {
                summary += `<strong>Add-ons:</strong> ${state.selectedAddons.length} selected<br>`;
            }
            summary += `<strong>Payment:</strong> ${term.label}<br>`;
            summary += `<strong>Prospects/Month:</strong> ${pkg.prospects}`;

            document.getElementById('proposal-summary').innerHTML = summary;
        }

        async function sendEmail() {
            const recipientEmail = document.getElementById('recipient-email').value.trim();
            if (!recipientEmail) {
                showToast('Please enter a valid email address', 'error');
                return;
            }

            const pkg = packages.find(p => p.id === state.selectedPackage);
            const term = paymentTerms.find(t => t.id === state.selectedPaymentTerm);

            const emailParams = {
                to_email: recipientEmail,
                from_email: SENDER_EMAIL,
                from_name: SENDER_NAME,
                package_name: pkg.name,
                monthly_price: Math.round(calculateTotal(false) * (1 - term.discount / 100)),
                setup_price: Math.round(pkg.setupPrice * (1 - term.discount / 100)),
                payment_term: term.label,
                discount: term.discount,
                prospects: pkg.prospects
            };

            showToast('Sending email...');

            try {
                // Try Resend first
                const response = await fetch('https://api.resend.com/emails', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${RESEND_API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        from: `${SENDER_NAME} <${SENDER_EMAIL}>`,
                        to: recipientEmail,
                        subject: `Custom Marketing Proposal for BMJ-Machinery - ${pkg.name}`,
                        html: generateEmailHTML(emailParams),
                        attachments: [
                            {
                                filename: 'BMJ-Machinery-Proposal.pdf',
                                content: await generatePDFBase64(emailParams)
                            }
                        ]
                    })
                });

                if (response.ok) {
                    showToast('âœ“ Email sent successfully with Resend!');
                    closeModal();
                    return;
                }
            } catch (err) {
                console.log('Resend failed, trying EmailJS...');
            }

            // Fallback to EmailJS
            try {
                await emailjs.init(EMAILJS_PUBLIC_KEY);
                await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, emailParams);
                showToast('âœ“ Email sent successfully!');
                closeModal();
            } catch (err) {
                console.error('Email error:', err);
                showToast('Failed to send email. Please try again.', 'error');
            }
        }

        function generateEmailHTML(params) {
            return `
                <div style="font-family: Arial, sans-serif; color: #333; line-height: 1.6;">
                    <h2>Dear Eric / Chi Feng,</h2>
                    <p>Please find attached our detailed marketing proposal tailored specifically for BMJ-Machinery.</p>
                    <h3>Proposal Summary:</h3>
                    <p>
                        <strong>Package:</strong> ${params.package_name}<br>
                        <strong>Monthly Investment:</strong> $${params.monthly_price.toLocaleString()} (after ${params.discount}% discount)<br>
                        <strong>Setup Cost:</strong> $${params.setup_price.toLocaleString()}<br>
                        <strong>Payment Frequency:</strong> ${params.payment_term}<br>
                        <strong>Prospects Reached/Month:</strong> ${params.prospects}
                    </p>
                    <p>The attached PDF includes complete details of all deliverables, services, pricing breakdown, expected outcomes, and terms.</p>
                    <p>We look forward to discussing this proposal with you.</p>
                    <p>Best regards,<br><strong>${SENDER_NAME}</strong><br>${SENDER_EMAIL}</p>
                </div>
            `;
        }

        async function generatePDFBase64(params) {
            // PDF generation logic here (simplified for Resend)
            return 'data:application/pdf;base64,JVBERi0xLjQKJeLjz9MNCjEgMCBvYmo+...'; // Placeholder
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.display = 'block';
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        // Initialize
        init();
    </script>
</body>
</html>
